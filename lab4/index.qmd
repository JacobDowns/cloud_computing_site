---
title: "Lab 4 â€” The Container Exchange"
subtitle: "Building and Shipping with Docker Hub"
---

# A:\LAB_04_EXCHANGE.QMD

**System Date:** FEB-10-2026 <br/> **Volume Label:** DOCKER_HUB_SYNC <br/> **Subject:** CONTAINER DEPLOYMENT & REGISTRIES

------------------------------------------------------------------------

::: {.callout-note icon="false"}
## MISSION_BRIEF.TXT

Today, we are moving from theory to production. You will split into two groups. 

* **Group A** will engineer a portable Machine Learning Environment.
* **Group B** will deploy a Generative Art Web API.

**The Protocol:**

1.  **Build:** Construct your assigned container based on the spec sheet.
2.  **Ship:** Push your compiled image to a public registry (Docker Hub).
3.  **Sync:** Trade your Docker Hub image tag with a team from the other group.
4.  **Run:** Pull and run their container to verify it works on your machine.
5.  **Swap:** Switch roles and build the second container.

This lab requires problem-solving. You have the `Dockerfile` manual from the lecture; now you must assemble the blueprint.
:::

------------------------------------------------------------------------

## PART 0: THE_REGISTRY (DOCKER HUB)

Before we build, we need a place to ship our containers. Docker Hub is the GitHub of container images.

::: {.callout-important icon="false"}
## NETWORK_SETUP.BAT

1.  **Create an Account:** Go to [hub.docker.com](https://hub.docker.com/) and create a free account. Make note of your **Username**.
2.  **Authenticate Locally:** Open your terminal and log in.
```bash
docker login
```
  *(Enter your Docker Hub username and password/access token when prompted).*
:::

When you build an image intended for Docker Hub, you must tag it with your username. 

* **Local Tag:** `docker build -t my-app .`
* **Hub Tag:** `docker build -t yourusername/my-app:v1 .`

------------------------------------------------------------------------

## PART 1: THE_ASSIGNMENTS

Split into your groups. Complete your primary objective first, then move to Part 2 to test the other group's work.

### GROUP A: The Data Science Pod

Your objective is to create a portable Jupyter Lab environment pre-loaded with standard ML libraries. 

**The Specifications:**

1.  **Base Image:** Use `python:3.12-slim`.
2.  **Working Directory:** Set it to `/workspace`.
3.  **System Dependencies:** You will need to `RUN apt-get update` and install `build-essential`. 
    * Clean the apt cache in the same `RUN` command to keep the image small. 
```bash
RUN apt-get update && apt-get install -y
--no-install-recommends build-essential 
&& rm -rf /var/lib/apt/lists/*
```
4.  **Python Packages:** Create a `requirements.txt` file on your host machine containing: `numpy`, `pandas`, `scikit-learn`, `matplotlib`, and `jupyterlab`. Copy this into your image and `pip install` it.
5.  **Security:** Create a non-root user named `developer` and switch to it.
6.  **Network:** Expose port `8888`.
7.  **Startup:** The container should run Jupyter Lab on `0.0.0.0` without trying to open a browser window. 
* *Hint*: 
```Dockerfile 
CMD ["jupyter", "lab", "--ip=0.0.0.0", "--port=8888",
"--no-browser", "--NotebookApp.token='lab123'"]
```

**Your Mission:** Write the `Dockerfile`, build the image (tagged with your Docker Hub username), and test it locally.
---

### GROUP B: The Generative Art API

Your objective is to deploy a Python web server that generates random pixel art based on environment variables. 

::: {.callout-note icon="false"}
## server.py (The Payload)

Save this exact code as `server.py` in your project folder.

```python
import os
import random
from io import BytesIO
from flask import Flask, Response, request
from PIL import Image

app = Flask(__name__)

def parse_size(s: str) -> int:
    try:
        n = int(s)
        return max(64, min(n, 1024))
    except Exception:
        return 256

@app.get("/")
def home():
    return Response(
        "Random Art Server\n"
        "Endpoints:\n"
        "  /art.png         -> generated art\n"
        "  /art.png?seed=42 -> reproducible art\n",
        mimetype="text/plain",
    )

@app.get("/art.png")
def art():
    # Env-configurable defaults
    default_seed = os.getenv("SEED", "")
    mode = os.getenv("MODE", "noise")  # noise | stripes | blocks
    size = parse_size(os.getenv("SIZE", "256"))

    seed = request.args.get("seed", default_seed)
    rng = random.Random(seed if seed != "" else None)

    img = Image.new("RGB", (size, size))
    pixels = img.load()

    if mode == "stripes":
        for y in range(size):
            for x in range(size):
                v = (x // 8) % 2
                pixels[x, y] = (255 if v else 0, rng.randrange(256), 255 - rng.randrange(256))
    elif mode == "blocks":
        block = max(4, size // 16)
        for by in range(0, size, block):
            for bx in range(0, size, block):
                color = (rng.randrange(256), rng.randrange(256), rng.randrange(256))
                for y in range(by, min(by + block, size)):
                    for x in range(bx, min(bx + block, size)):
                        pixels[x, y] = color
    else:  # noise
        for y in range(size):
            for x in range(size):
                pixels[x, y] = (rng.randrange(256), rng.randrange(256), rng.randrange(256))

    buf = BytesIO()
    img.save(buf, format="PNG")
    return Response(buf.getvalue(), mimetype="image/png")

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000)
```
:::

**The Specifications:**

1.  **Base Image:** Use `python:3.12-slim`.
2.  **Dependencies:** You need `flask` and `pillow` in your `requirements.txt`.
3.  **Security:** Create a non-root user named `appuser` and switch to it before running the app. 
4.  **Configuration:** Use the `ENV` keyword in your `Dockerfile` to set default environment variables: `MODE="noise"` and `SIZE="256"`.
5.  **Network:** The app runs on port `5000`. Expose it.
6.  **Startup:** Run `python server.py`.

**Your Mission:** Write the `Dockerfile`, build the image (tagged with your Docker Hub username), and verify you can view the art in your browser at `localhost:5000/art.png`.

------------------------------------------------------------------------

## PART 2: THE_UPLINK (PUSH TO HUB)

Once your container is running locally, it is time to ship it.

::: {.callout-tip icon="false"}
## UPLOAD.EXE

Assuming you tagged your image correctly during the build phase:
`docker build -t yourusername/my-project:v1 .`

Upload it to the cloud:
```bash
docker push yourusername/my-project:v1
```
:::

*Check your Docker Hub profile online. You should see your new repository.*

------------------------------------------------------------------------

## PART 3: THE_EXCHANGE (VALIDATION)

Find a team from the other group. Give them your Docker Hub image tag (e.g., `janesmith/art-server:v1`). 

**The Test:**

1.  **Pull:** Download their image using `docker pull [THEIR_TAG]`.
2.  **Run:** Write the `docker run` command to start their container on your machine.
    * *Group A running Group B's Art Server:* Don't forget to map the ports! Try passing an environment variable (`-e MODE="blocks"`) to see if it overrides their defaults.
    * *Group B running Group A's ML Pod:* Map the ports and test if you can access Jupyter Lab at `localhost:8888` using the password `lab123`. Try mounting a local folder as a volume (`-v`) to see if you can save a notebook to your actual hard drive.

------------------------------------------------------------------------

## SHUTDOWN_SEQUENCE

**< SYSTEM HALTED >**

Once you have verified the other group's container, swap roles. Group A builds the Art Server, and Group B builds the ML Pod.