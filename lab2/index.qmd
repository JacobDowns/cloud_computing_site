---
title: "Lab 2 — Clone the Starter Repo and Implement Cloud Notes"
---

## Overview

::: {.callout-note collapse="false"}
## lab2.exe — What you are doing

In this lab, you'll create a simple cloud notes app in Firebase. Although simple, this 
demonstrates some features of a real app like user sign in with Google, and permanent storage of notes with Firestore. 

You will clone the official starter repo, configure Firebase for your account, run the app locally, and extend it to implement the notes backed by Firestore. Then we'll demonstrate and fix an insecure query using Firestore Rules.
:::

## Step 0 — Clone the starter repository

::: {.callout-note collapse="false"}
## git.exe — Starter repo

Run:

```bash
git clone https://github.com/Cloud-Course-Spring-2026/cloud-notes
cd cloud-notes
npm install
```
:::

## Part A — Create and configure a Firebase project

## Step 1 — Create a Firebase project (student's own)
1. Go to: https://console.firebase.google.com  
2. Click **Add project**
3. Name it: `cloud-notes-<yourname>` (or similar)
4. Google Analytics can be enabled or disabled; it doesn't matter. 

## Step 2 — Register a Web App (get config)
To register your web app:

- Navigate to: <br/>
 Project settings → General → Your apps → Add app → Web
- You may choose any nickname for you app. 
- Check set up **Firebase Hosting** 
- Copy the code snippet Firebase gives you containing things like the `apiKey`, `authDomain` and save it somewhere temporary. You'll paste them into `.env.local` shortly. Alternatively, you'll be able to retrieve this information later 

## Step 3 — Enable Google Sign-In (Authentication)
Next, we'll enable authentication in your project to allow users to sign in to your notes app with their Google account. 

- In the Firebase Console go to: <br/>
 Build → Authentication → Get Started → Sign-in method 
- Under **Additional Providers** click on Google
- Check **Enable**
- You can use your gmail address for the support email
- Click **Save**


## Step 4 — Create a Firestore database
To allow permanent storage of notes, we'll create a Firestore database. 


- In the Firebase console go to: <br/>
Build → Firestore Database → Create database  
- Select **Standard Edition**
- Choose any location (default is fine)
- Start in **test mode** for now; we'll add rules later to control access.

---

## Part B — Configure the cloned project

## Step 5 — Create `.env.local` in repo root
The `.env.local` file will store information needed to communicate with your Firebase app. Add these entries (no quotes) to a file called `.env.local` in the repo root:

```env
VITE_FIREBASE_API_KEY=PASTE_ME
VITE_FIREBASE_AUTH_DOMAIN=PASTE_ME
VITE_FIREBASE_PROJECT_ID=PASTE_ME
VITE_FIREBASE_APP_ID=PASTE_ME
```

Note, you must name it `.env.local`. Also, confirm `.env.local` is listed in `.gitignore` (it should be already). While these aren't secrets, it's still good practice to make sure they are not commited. 

**Restart** the dev server after editing env vars with `npm run dev`. 

## Step 6 — Install Firebase SDK 
In the root directory of the cloned repo run:

```bash
npm install firebase
```

---

## Part C — Main files

Take a brief look at the main files that control the app provided in the starter repo. You won't need to understand the details of this code, but it's worth looking at how the front end code uses the Firebase SDK and the basic operations that are happening in the notes app. Here are the four scripts to look at:

### `src/firebase.ts`
> Initializes the Firebase app and exports `auth` and `db` handles for use by other modules.

### `src/auth.ts`
> Small wrappers around Firebase Auth for sign-in, sign-out, and auth-state subscription.

### `src/notes.ts`
> Encapsulates Firestore queries and writes. Provides per-user subscription and a demo all-notes subscription.

### `src/App.tsx`
> The UI glue: subscribes to auth, subscribes to notes, and renders the note list and controls (including the insecure demo toggle).

---

## Part D — First deployment 

::: {.callout-important collapse="false"}
## deploy-first.exe — Deploy your app

Now, deploy your app once and test the deployed version.  

1. Log in and select your Firebase project for the CLI:

```bash
firebase login
firebase use --add
```

Choose your project and set the alias to `default`.

2. Build the production files:

```bash
npm run build
```

3. Deploy to Firebase Hosting:

```bash
firebase deploy
```

When deployment finishes, Firebase will print a Hosting URL like:

```
https://<your-project-id>.web.app
```

Make sure you're able to log in to your app and add notes. Ensure that notes are persistent. Once you've tested your app, save the URL. Now you're ready to share it with classmates!
:::

---

## Part E — In-class activity: the insecure query

::: {.callout-important collapse="false"}
## activity.exe — Interacting with classmates’ apps

- Now, find a classmate to share your URL with. Have them log in and add some notes. 
- Return to your own deployed app and toggle **“Demo: subscribe to all notes”**
- If your Firestore rules are still in **test mode**, you will likely be able to see notes from other users.

That is the security problem we will fix next.
:::

---

## Part F — Fixing the problem: Firestore Security Rules

## Step 8 — Add Firestore rules

::: {.callout-note collapse="false"}
## rules.exe — Server-side authorization

Firebase Console → Firestore Database → **Rules**

Replace the test-mode rules with:

```js
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    match /notes/{noteId} {
      allow create: if request.auth != null
                    && request.resource.data.uid == request.auth.uid
                    && request.resource.data.text is string;

      allow read, update, delete: if request.auth != null
                                  && resource.data.uid == request.auth.uid;
    }
  }
}
```

Click **Publish**.
:::

## Step 9 — Verify the fix

::: {.callout-tip collapse="false"}
## verify.exe

Return to your **deployed app**:

- Toggle **“Demo: subscribe to all notes”**
- You should now see a permission error (or only your own notes)
- Toggle back to the normal view and confirm your notes still load

This demonstrates that **authorization is enforced by Firestore rules, not by the UI**.
:::

---

## Part G — (Optional) Redeploy after rules changes

Firestore rules take effect immediately and do **not** require redeploying your app.  
You only need to redeploy if you change frontend code.

---

## Submission

::: {.callout-important collapse="false"}
## submit.txt — What to turn in

Submit:

1. Your Firebase Hosting URL
2. Short responses to the following questions:
   - What is the difference between **authentication** and **authorization**?
   - Why did the “show all notes” query work before rules but fail after rules?
   - Where is security enforced in this architecture?
:::

---

## Troubleshooting notes

::: {.callout-warning collapse="true"}
## errorlog.txt

- If notes do not persist, verify `.env.local` projectId matches the Firebase Console project.
- Restart `npm run dev` after editing `.env.local`.
- If snapshot listeners hang, try `initializeFirestore(app, { experimentalForceLongPolling: true })`.
- Firestore rules changes do not require redeploying Hosting.
:::